{% extends 'base.html' %}
{% block content %}



<!-- stored d3 files in base.html -->


<div class="container-fluid">
	<div class="row-fluid">
		 <div class="col-md-3" id="card-summary">
		 	<strong>Card Info:</strong>

			<!-- for loop in jinjia! -->
			{% for card in query_results %}
				<br>
				<br>
				Card name: {{card.card_name}}
				<br>
				Card debt: {{card.card_debt }}	
				<br>
				Card apr: {{card.card_apr}}
				<br>
				Card time to pay off: {{card.card_date}}
				<br>
			{% endfor %}
			<br>
			<br>
		 </div>
  		<div class="col-md-9" id="main">
  			<div class="col-xs-12 col-md-12 col-lg-12" id="visualization">
				Visualization:
				

				<div id="chart">
					<script>

					var format = d3.time.format("%m/%d/%y");

					var margin = {top: 20, right: 30, bottom: 30, left: 40},
					    width = 960 - margin.left - margin.right,
					    height = 500 - margin.top - margin.bottom;

					var x = d3.time.scale()
					    .range([0, width]);

					var y = d3.scale.linear()
					    .range([height, 0]);

					var z = d3.scale.category20c();

					var xAxis = d3.svg.axis()
					    .scale(x)
					    .orient("bottom")
					    .ticks(d3.time.days);

					var yAxis = d3.svg.axis()
					    .scale(y)
					    .orient("left");

					var stack = d3.layout.stack()
					    .offset("zero")
					    .values(function(d) { return d.values; })
					    .x(function(d) { return d.date; })
					    .y(function(d) { return d.value; });

					var nest = d3.nest()
					    .key(function(d) { return d.key; });

					var area = d3.svg.area()
					    .interpolate("cardinal")
					    .x(function(d) { return x(d.date); })
					    .y0(function(d) { return y(d.y0); })
					    .y1(function(d) { return y(d.y0 + d.y); });

					var svg = d3.select("body").append("svg")
					    .attr("width", width + margin.left + margin.right)
					    .attr("height", height + margin.top + margin.bottom)
					  .append("g")
					    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");


					var data = [
						{
			                "date": "2015-05-31",
			                "amount": 3000
			            },
			            {
			                "date": "2015-06-30",
			                "amount": 2802.56
			            },
			            {
			                "date": "2015-07-31",
			                "amount": 2602.94
			            },
			            {
			                "date": "2015-08-31",
			                "amount": 2401.12
			            },
			            {
			                "date": "2015-09-30",
			                "amount": 2197.06
			            },
			            {
			                "date": "2015-10-31",
			                "amount": 1990.74
			            },
			            {
			                "date": "2015-11-30",
			                "amount": 1782.14
			            },
			            {
			                "date": "2015-12-31",
			                "amount": 1571.24
			            },
			            {
			                "date": "2016-01-31",
			                "amount": 1357.99
			            },
			            {
			                "date": "2016-02-29",
			                "amount": 1142.38
			            },
			            {
			                "date": "2016-03-31",
			                "amount": 924.39
			            },
			            {
			                "date": "2016-04-30",
			                "amount": 703.97
			            },
			            {
			                "date": "2016-05-31",
			                "amount": 481.11
			            },
			            {
			                "date": "2016-06-30",
			                "amount": 255.78
			            },
			            {
			                "date": "2016-07-31",
			                "amount": 27.95
			            }    
            		];

            		var dataset = [
            				[ 
            					{x: 2015-05-31, y:3000},
            					{x: 2015-06-30, y:2802.56}, 
            					{x: 2015-07-31, y:2602.94},
            					{x: 2015-08-31, y:},
            					{x: 2015-09-30, y:},
            					{x: 2015-10-31, y:},
            					{x: 2015-11-30, y:}, 
            					{x: 2015-12-31, y:},
            					{x: 2016-01-31, y:},
            					{x: 2016-02-29, y:},
            					{x: 2016-03-31, y:},
            					{x: 2016-04-30, y:}, 
            					{x: 2016-05-31, y:},
            					{x: 2016-06-30, y:},
            					{x: 2016-07-31, y:},
            				]
            		]
					// d3.json("../static/d3-data.json", function(error, data) {
   		// 				data.forEach(function(d) {
					//     d.date = parseDate(d.date);
					//     d.value = +d.value;
					// })

   					// *******************************************
   					// How to get at my data points for D3
   					// points[0] = Minimum payment dict
   					// points[0].values() = list of list of dictionary points (date, amount)
   					// value_list = points[0].values()
   					// value_list[0][0] = first dictionary of a point

   					// points[1] = suggested payments dict
   					// points[1].values() = list of list of dictionary points (date, amount)
   					// value_list = points[1].values()
   					// value_list[0][0] = first dictionary of a point


					// d3.csv("data.csv", function(data) {
					//   data.forEach(function(d) {
					//     d.date = format.parse(d.date);
					//     d.value = +d.value;
					//   });

					  var layers = stack(nest.entries(data));

					  x.domain(d3.extent(data, function(d) { return d.date; }));
					  y.domain([0, d3.max(data, function(d) { return d.y0 + d.y; })]);

					  svg.selectAll(".layer")
					      .data(layers)
					    .enter().append("path")
					      .attr("class", "layer")
					      .attr("d", function(d) { return area(d.values); })
					      .style("fill", function(d, i) { return z(i); });

					  svg.append("g")
					      .attr("class", "x axis")
					      .attr("transform", "translate(0," + height + ")")
					      .call(xAxis);

					  svg.append("g")
					      .attr("class", "y axis")
					      .call(yAxis);
					

					</script>
				</div>


				<!-- <svg width="500" height="100">
					<circle cx="50" cy="50" r="40" stroke="black" stroke-width="3" fill="grey" />
					<circle cx="200" cy="50" r="40" stroke="black" stroke-width="3" fill="red" />
					<circle cx="350" cy="50" r="40" stroke="black" stroke-width="3" fill="grey" />
				</svg> -->
			</div>

	 
			<div class="col-xs-6 col-md-6 col-lg-6">
				<div id="sugg_plan">
					<br>
					<br>
					Suggested
						<br>
						<br>
						<!--  convert to strings -->
						<strong>Total Suggested Debt Decreasing (Debt, Int, Payment):</strong>
						{{all_totals[1].to_html(classes="table table-striped") | safe}}
						
						<br>
						<br>
				</div>
			</div>

			<div class="col-xs-6 col-md-6 col-lg-6">
				<div id="min_plan">
						<br>
						<br>
						Minimum
						<br>
						<br>
						<strong>Total Minimum Debt (Debt, Int, Payment):</strong>
						{{all_totals[0].to_html(classes="table table-striped") | safe}}
						<br>	
						<br>
						<br>
				</div>
			</div>
		</div>
	</div>
</div>





<div id="action">
	Take action div.
	<!--  add in a note here that if a card doesn't have 0apr, suggest to switch to a 0 apr
	ONLY if they can pay it off within that date... -->
</div>

<!-- Use this! http://getbootstrap.com/examples/dashboard/ -->



{% endblock %}


